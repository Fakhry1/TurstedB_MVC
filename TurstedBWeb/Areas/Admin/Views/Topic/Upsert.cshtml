 <!-- Start Stepper HTML -->
@model TopicVM

@{
    var State = 0;
    var path = "" ;

}
 <div class="container mt-5">
    <div class="row">
        <form  enctype="multipart/form-data" method="post">
        <div class="accordion" id="accordionExample">
            <div class="steps">
                <progress id="progress" value=0 max=100></progress>
                <div class="step-item">
                    <button id="your-id" class="step-button text-center" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        1
                    </button>
                    <div class="step-title">
                        قيد اعداد
                    </div>
                </div>
                <div class="step-item">
                    <button id="your-id" type="button" class="step-button text-center collapsed" data-bs-toggle="collapse"
                            data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        2
                    </button>
                    <div class="step-title">
                        اعتماد
                    </div>
                </div>
                <div class="step-item">
                    <button id="your-id" type="button" class="step-button text-center collapsed" data-bs-toggle="collapse"
                            data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        3
                    </button>
                    <div class="step-title">
                        تصحيح لغوي
                    </div>
                </div>

                <div class="step-item">
                    <button id="your-id" type="button" class="step-button text-center collapsed" data-bs-toggle="collapse"
                            data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        4
                    </button>
                    <div class="step-title">
                        اعتماد تصميم
                    </div>
                </div>

                <div class="step-item">
                    <button id="your-id" type="button" class="step-button text-center collapsed" data-bs-toggle="collapse"
                            data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                        5
                    </button>
                    <div class="step-title">
                        نشر
                    </div>
                </div>
            </div>


        </div>

    </form>
</div>
</div>
<!-- End Start Stepper HTML -->

<div class="card shadow border-0 ">
    <div class="card-header bg-secondary bg-gradient ml-0 py-3">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="text-white py-2"> @(Model.topic.TopicId != Guid.Empty  ? @_localization.Getkey("Update") : @_localization.Getkey("Create")) @_localization.Getkey("Topic")</h2>
            </div>
        </div>
    </div>
    <div class="card-body ">
        <form method="post" class="row" enctype="multipart/form-data">
            <input asp-for="topic.TopicId" hidden />
            <input type="hidden" value=@Model.topic.TopicFile id="myVar" />
          
            <div class="row">
                <div class="col-12">
                    <div class="border p-3">

                        <div class="row">
                        <div class="form-floating py-2 col-4">
                                <input asp-for="topic.Titel" class="form-control border-0 shadow" />
                                <label asp-for="topic.Titel" class="ms-2"></label>
                                <span asp-validation-for="topic.Titel" class="text-danger"></span>
                        </div>

                        <div class="form-floating py-2 col-4">

                                <select asp-for="topic.TopicClassification" asp-items=@(new List<SelectListItem> { new SelectListItem {Text="توجيه",Value="توجيه" }
                                    ,new SelectListItem {Text="درس فيديو",Value="درس فيديو" } ,new SelectListItem {Text="درس صوت",Value="درس صوت" }
                                    ,new SelectListItem {Text="اعلان",Value="اعلان" } ,new SelectListItem {Text="صور",Value="صور" }} ) class="form-select">
                                <option disabled selected></option>
                            </select>
                                <label asp-for="topic.TopicClassification" class="ms-2"></label>
                        </div>
                            <div class="form-floating py-2 col-4">

                                <select asp-for="topic.State" asp-items=@(new List<SelectListItem> { new SelectListItem {Text="قيد اعداد",Value="قيد اعداد" }
                                        ,new SelectListItem {Text="اعتماد",Value="اعتماد" } ,new SelectListItem {Text="تصحيح لغوي",Value="تصحيح لغوي" }
                                        ,new SelectListItem {Text="اعتماد تصميم",Value="اعتماد تصميم" } ,new SelectListItem {Text="نشر",Value="نشر" }} ) class="form-select">
                                    <option disabled selected></option>
                                </select>
                                <label asp-for="topic.State" class="ms-2"></label>
                            </div>
                             @if (Model.topic.TopicId != Guid.Empty)
                            {
                                
                                @if (@Model.topic.State == "قيد اعداد")
                                {
                                    State = 1;
                                }
                                else if (@Model.topic.State == "اعتماد")
                                {
                                    State = 2;
                                }
                                else if (@Model.topic.State == "تصحيح لغوي")
                                {
                                    State = 3;
                                }
                                else if (@Model.topic.State == "اعتماد تصميم")
                                {
                                    State = 4;
                                }
                                else if (@Model.topic.State == "نشر")
                                {
                                    State = 5;
                                }
                            }

                       
                        </div>
                        <div class="row">
                        <div class="form-floating py-2 col-12">
                                <label asp-for="topic.TopicDiscription" class="ms-2 text-muted mb-1"></label>
                                <textarea asp-for="topic.TopicDiscription" class="form-control"></textarea>
                        </div>
                        </div>

                        <div class="row">
                        
                        <div class="form-floating py-2 col-4">
                                <input asp-for="topic.FileSize" class="form-control border-0 shadow" />
                                <label asp-for="topic.FileSize" class="ms-2"></label>
                       
                        </div>

                        <div class="form-floating py-2 col-4">

                                <select asp-for="topic.Active" asp-items=@(new List<SelectListItem> { new SelectListItem {Text="نعم",Value="نعم" }
                                   ,new SelectListItem {Text="لا",Value="لا" }} ) class="form-select">
                                <option disabled selected></option>
                            </select>
                                <label asp-for="topic.Active" class="ms-2"></label>
                        </div>

                            <div class="form-floating py-2 col-4">

                                <input type="text" asp-for="topic.CreationDate" class="form-control" disabled />
                              
                                <label asp-for="topic.CreationDate" class="ms-2"></label>
                             
                            </div>

                        </div>

                        <div class="row">
                            <hr class="hr mt-3" />
                            @if (Model.topic.TopicId != Guid.Empty)
                            {

                                path = @Model.topic.TopicFile;

                                @Html.Hidden("myVar", @Model.topic.TopicFile);

                            <div class="form-floating col-4 ">

                                    <input asp-for="topic.TopicFile" id="input-21" type="file">
                                </div>

                             


                            }
                            else
                            {

                               
                                <div class="form-floating py-2 col-4 ">
                                       
                                    <input asp-for="topic.TopicFile" id="input-20" type="file">
                                </div>

                                

                            }
                            @* ______________________State History___________________________________ *@
                           
                            <div class="form-floating col-8 ">

                                <table id="tblData" class="table table-success table-striped" style="width:100%">
                                <thead>

                                    <tr>
                                        <th>@_localization.Getkey("User")</th>
                                        <th>@_localization.Getkey("State")</th>
                                        
                                       

                                    </tr>

                                </thead>
                                <tbody>
                                        @if (Model.StateHistoryList != null)
                                        {
                                    @foreach (var obj in Model.StateHistoryList.OrderBy(u => u.StateSetDate))
                                    {
                                        <tr>
                                            <td>@obj.ApplicationUser.Name</td>
                                            <td>
                                                <div>
                                                @obj.State
                                                </div>
                                                <div class="h6" >
                                                        @obj.StateSetDate
                                                </div>
                                                
                                            </td>
                                                    
                                            
                                        </tr>
                                    }
                                        }
                                </tbody>
                            </table>

                            </div>
                           @*  ___________________________________________________________ *@
                       
                            </div>
                       @*  <img class='kv-preview-data file-preview-image' src='https://picsum.photos/id/260/1920/1080'> *@

                    </div>
                </div>

            </div>


            <div class="row pt-2">
                <div class="col-6 ">
                    @if (Model.topic.TopicId != Guid.Empty)
                    {
                        <button type="submit" class="btn btn-primary form-control">@_localization.Getkey("Update")</button>
                    }
                    else
                    {
                        <button type="submit" class="btn btn-primary form-control">@_localization.Getkey("Create")</button>
                    }
                </div>
                <div class="col-6">
                    <a asp-controller="Topic" asp-action="Index" class="btn btn-outline-primary border  form-control">
                        @_localization.Getkey("Back to List")
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts{
    <script>
        tinymce.init({
            selector: 'textarea',
            plugins: 'anchor autolink charmap codesample emoticons  lists   table visualblocks wordcount',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough |  align lineheight | numlist bullist indent outdent',
        });
    </script>


    <script>
        var loadFile = function (event) {
            var image = document.getElementById('up-file');
            image.src = URL.createObjectURL(event.target.files[0]);
        };

    </script>

   @* ____________________________________*@

   <script>
        $(document).ready(function () {
            // For Bootstrap 5.x
            $("#input-20").fileinput({
                browseClass: "btn btn-info",
                mainClass: "d-grid",
                showCaption: false,
                showRemove: false,
                showUpload: false
            });
         });
   </script>
   <script>


        // var url = "\\Files\\Topics\\46f1691f-c62f-4c56-abb8-f8e7a15ec6cf.mp4";

        var url = $('#myVar').val();
      
        $(document).ready(function () {
           
            $("#input-21").fileinput({
                browseClass: "btn btn-info",
                mainClass: "d-grid",
                showCaption: false,
                showRemove: false,
                showUpload: false,

                // allowedFileTypes: ["pdf", "video/mp4"],
                initialPreview: [
                    
                    url
                
                ],
                initialPreviewConfig: [
                   // { type: 'pdf', filetype: "pdf" }

                           { type: "video", filetype: "video/mp4"}

                ],
                initialPreviewAsData: true
                
              
            });
        });
    </script>

    <script>

        const stepButtons = document.querySelectorAll('.step-button');
        const progress = document.querySelector('#progress');
        var form = document.getElementById("form-id");
        var step = @State;
               Array.from(stepButtons).forEach((button, index) => {
            if (index < step) { button.classList.add('done') }
            progress.setAttribute('value', step * 100 / (stepButtons.length - 1));
        });

        Array.from(stepButtons).forEach((button, index) => {
            button.addEventListener('click', () => {
                progress.setAttribute('value', index * 100 / (stepButtons.length - 1));//there are 3 buttons. 2 spaces.
                //stepButtons.classList.add('done');
                stepButtons.forEach((item, secindex) => {

                    if (index >= secindex) {
                        item.classList.add('done');
                        //document.getElementById("your-id").addEventListener("click", function () {
                        //    form.submit();
                        //});

                    }
                    if (index < secindex) {
                        item.classList.remove('done');
                        //document.getElementById("your-id").addEventListener("click", function () {
                        //    form.submit();
                        //});
                    }
                })
            })
        });
    </script>


    @{
                                        <partial name="_ValidationScriptsPartial" />
    }
}